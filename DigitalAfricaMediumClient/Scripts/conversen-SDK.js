window.setTimeout(function(){window.fbAsyncInit&&window.fbAsyncInit.hasRun&&window.cnvAsyncInit&&!window.cnvAsyncInit.hasRun?(window.cnvAsyncInit.hasRun=!0,window.cnvAsyncInit()):window.fbAsyncInit||!window.cnvAsyncInit||window.cnvAsyncInit.hasRun||(window.cnvAsyncInit.hasRun=!0,window.cnvAsyncInit())},0);window.Cnv=window.Cnv||{};!function(n,t){function tt(n,t){var v=new Date,y=new Date(v.getTime()+6048e5),f="xyz_cr_"+t.custId+"_et_"+t.entityId,s=null,p,a,u;typeof FB!="undefined"&&(s=window.FB._apiKey);o=t.cookieDomain;d=r.load(f);ot(d);r.data.cr=t.custId===undefined?r.data.cr:t.custId;r.data.et=t.entityId===undefined?r.data.et:t.entityId;r.data.ap=s;r.save(f,y,"/");h=t.debug;p=t.params;a=t.enableSocialEvents===undefined?!0:t.enableSocialEvents;a&&(u=document.createElement("iframe"),u.name="cnvIframe",u.id="cnvIframe",u.src=n+"sts/SocialEvent/Event",u.style="display:none;",document.body.appendChild(u),i.bind("CnvEventListener",function(n){var t,i;n.errorData?(t=l[n.GuidId],t&&t(n.errorData)):n.successData&&(i=c[n.GuidId],i(n.successData));c[n.GuidId]=null;l[n.GuidId]=null}),i.bind("FinishedLoading",function(n){var t,i,r;if(n){for(w=n,t=0,i=e;t<i;t++)r=e[t],Cnv.RenderContent(r);e=null}}));t.enableFacebook&&(isNaN(r.data.ap)||isNaN(r.data.cr)||isNaN(r.data.et)?Cnv.Log("Failed to initialize Conversen.FB.init","sts"):(window.FB.Event.subscribe("auth.login",it),window.FB.Event.subscribe("auth.logout",conversenAuthLogout),window.FB.Event.subscribe("edge.create",ut),window.FB.Event.subscribe("comment.create",ft),window.FB.Event.subscribe("message.send",rt),window.FB.Event.subscribe("fb.log",Cnv.Log)))}function it(n){var t={};t.au=n;t.rp=r.data;u(t,"sts/AuthLogin",null);window.FB.api("/me",function(n){window.FB.api("/me/likes",function(t){var i={},f={},e;f.me=n;f.likes=t;i.pf=f;i.rp=r.data;e="sts-profile-"+f.me.id;r.load(e)==!1&&(r.data={postedProfile:"true"},r.save(e),u(i,"sts/Profile",null));r.data=i.rp})})}function rt(n){var t={};t.rp=r.data;t.href=n;u(t,"sts/MessageSend",null)}function ut(n){var t={};t.rp=r.data;t.href=n;u(t,"sts/EdgeCreate",null)}function ft(n){var t=n.commentID,i=n.href,f=window.FB.Data.query('SELECT comments_fbid FROM link_stat WHERE url="{0}"',n.href);f.wait(function(n){var f=window.FB.Data.query("SELECT xid,object_id,post_id,fromid,time,text,id,username,reply_xid,post_fbid,likes,user_likes FROM comment WHERE object_id={0} AND post_fbid={1}",n[0].comments_fbid,t);f.wait(function(n){var t={},f;t.cc=n[0];t.cc.href=i;t.rp=r.data;u(t,"sts/CommentCreate",null);f="/"+n[0].fromid;window.FB.api(f,function(n){var t={},i={};i.me=n;t.pf=i;t.rp=r.data;u(t,"sts/Profile",null)})},function(n){Cnv.Log(n)})},function(n){Cnv.Log(n)})}function a(t,i){h===!0&&(document.getElementById("cnv-log").innerHTML+="<br />"+u);var u=decodeURIComponent(n.param(t)),r=f+i+"/image.gif?",e=g();r.length+u.length>=1900?et(r,i,u,e):(r=r+"isSplit=false&guid="+e+"&segmentNumber=1&",v(r,u))}function u(n,t,r){n.mt=t;i.send({target:window.frames.cnvIframe,type:"CnvEvent",data:n,error:function(){a(n,t,r)}})}function v(n,t){var i=document.createElement("img");i.style.display="none";i.src=n+t;document.body.appendChild(i);document.body.removeChild(i)}function et(n,t,i,r){for(var l=n.length,o,s,u=[],e=1,h,c;l+i.length>1900;)o=i.lastIndexOf("&",1600),s=i.substring(0,o),i=i.substring(o+1),u.push("isSplit=true&guid="+r+"&segmentNumber="+e+"&"+s+"&"),e++;for(u.push("isSplit=true&guid="+r+"&segmentNumber="+e+"&"+i+"&"),h="guid="+r+"&numberOfSegments="+e,c=f+t+"/header.gif?",v(c,h);u.length>0;)v(n,u.pop())}function g(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function ot(n){var t=st();t!==!1?t.tp===undefined?r.data=t:(r.data={},r.data.tp=t.tp):r.data=n}function st(){for(var i={},u={},f=!1,r,o=/\+/g,s=/([^&=]+)=?([^&]*)/g,e=function(n){return decodeURIComponent(n.replace(o," "))},h=window.location.search.substring(1),n,t;r=s.exec(h);)i[e(r[1])]=e(r[2]);for(n=0;n<b.length;n++)t=b[n],i[t]===undefined||(u[t]=i[t],f=!0);return f?u:!1}function ht(n){var s=n.replace(/(.*?\?)/,""),e=s.split("&"),i,o,f;for(stack={},i=0,o=e.length;i<o;i++){var r=e[i].split("="),t=r[0],u=isNaN(r[1])?r[1]:parseFloat(r[1]);t.match(/(.*?)\[(.*?)]/)?(t=RegExp.$1,f=RegExp.$2,t==="tp"&&isNaN(u)||(f?(t in stack||(stack[t]={}),stack[t][f]=u):(t in stack||(stack[t]=[]),stack[t].push(u)))):stack[t]=u}return stack}function ct(n){if(o)return o;var t=n.split("."),i=t.length,r=0;return t[i-1].length===2&&(t[i-2]==="co"||t[i-2]==="com")&&r++,t.slice(i-r-2,i).join(".")}var y,p,d,o;if(n===undefined){y=/\[\]$/;p=/%20/g;function s(n,t,i){var u,r,f;if(Object.prototype.toString.call(t)==="[object Array]")for(r=0,f=t.length;r<f;r++)y.test(n)?i(n,t[r]):s(n+"["+(typeof t[r]=="object"?r:"")+"]",t[r],i);else if(typeof t=="object")for(u in t)s(n+"["+u+"]",t[u],i);else i(n,t)}n={param:function(n){var i,r=[],u=function(n,t){t=t==null?"":t;r[r.length]=encodeURIComponent(n)+"="+encodeURIComponent(t)},t,f;if(Object.prototype.toString.call(n)==="[object Array]")for(t=0,f=n.length;t<f;t++)u(n[t].name,n[t].value);else for(i in n)s(i,n[i],u);return r.join("&").replace(p,"+")}}}t||(t={},!function(){function r(n){return n<10?"0"+n:n}function s(n){return o.lastIndex=0,o.test(n)?'"'+n.replace(o,function(n){var t=h[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function f(t,e){var l,a,h,v,y=n,c,o=e[t];o&&typeof o=="object"&&Object.prototype.toString.apply(o)==="[object Date]"&&(o=this.getUTCFullYear()+"-"+r(this.getUTCMonth()+1)+"-"+r(this.getUTCDate())+"T"+r(this.getUTCHours())+":"+r(this.getUTCMinutes())+":"+r(this.getUTCSeconds())+"Z");typeof i=="function"&&(o=i.call(e,t,o));switch(typeof o){case"string":return s(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":return String(o);case"object":if(!o)return"null";if(n+=u,c=[],Object.prototype.toString.apply(o)==="[object Array]"){for(v=o.length,l=0;l<v;l+=1)c[l]=f(l,o)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+y+"]":"["+c.join(",")+"]",n=y,h}if(i&&typeof i=="object")for(v=i.length,l=0;l<v;l+=1)a=i[l],typeof a=="string"&&(h=f(a,o),h&&c.push(s(a)+(n?": ":":")+h));else for(a in o)Object.hasOwnProperty.call(o,a)&&(h=f(a,o),h&&c.push(s(a)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+y+"}":"{"+c.join(",")+"}",n=y,h}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,u,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;t.stringify=function(t,r,e){var o;if(n="",u="",typeof e=="number")for(o=0;o<e;o+=1)u+=" ";else typeof e=="string"&&(u=e);if(i=r,r&&typeof r!="function"&&(typeof r!="object"||typeof r.length!="number"))throw new Error("JSON.stringify");return f("",{"":t})};t.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(e.lastIndex=0,e.test(n)&&(n=n.replace(e,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");}}());var i={poll:200,send:function(n){var r={target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1},f,u;for(k in n)r[k]=n[k];(f=r.target,r.target)&&r.type&&(u={data:r.data,type:r.type},r.success&&(u.callback=i._callback(r.success)),r.error&&(u.errback=i._callback(r.error)),"postMessage"in f&&!r.hash?(i._bind(),f.postMessage(t.stringify(u),r.origin||"*")):(i.hash._bind(),i.hash.send(r,u)))},bind:function(n,t,r,u){i._replyBind(n,t,r,u,!0)},_replyBind:function(n,t,r,u,f){var e,o;"postMessage"in window&&!u?i._bind():i.hash._bind();e=i.data("listeners.postmessage");e||(e={},i.data("listeners.postmessage",e));o=e[n];o||(o=[],e[n]=o);o.push({fn:t,callback:f,origin:r||"*"})},unbind:function(n,t){var r=i.data("listeners.postmessage"),f,e,s,o,u;if(r)if(n)if(t){if(f=r[n],f){for(e=[],u=0,s=f.length;u<s;u++)o=f[u],o.fn!==t&&e.push(o);r[n]=e}}else delete r[n];else for(u in r)delete r[u]},data:function(n,t){return t===undefined?i._data[n]:(i._data[n]=t,t)},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var t=[],n=0;n<32;n++)t[n]=i._CHARS[0|Math.random()*32];return t.join("")},_callback:function(n){var t=i.data("callbacks.postmessage"),r;return t||(t={},i.data("callbacks.postmessage",t)),r=i._random(),t[r]=n,r},_bind:function(){i.data("listening.postmessage")||(window.addEventListener?window.addEventListener("message",i._dispatch,!1):window.attachEvent&&window.attachEvent("onmessage",i._dispatch),i.data("listening.postmessage",1))},_dispatch:function(n){var r,h,e,c,o,f,l,u,a;try{if(n.origin.indexOf("fbcdn.net")!=-1)return;r=t.parse(n.data)}catch(s){}if(r.type)if(h=i.data("callbacks.postmessage")||{},e=h[r.type],e)e(r.data);else for(c=i.data("listeners.postmessage")||{},o=c[r.type]||[],f=0,l=o.length;f<l;f++){if(u=o[f],u.origin&&u.origin!=="*"&&n.origin!==u.origin){r.errback&&(a={message:"postmessage origin mismatch",origin:[n.origin,u.origin]},i.send({target:n.source,data:a,type:r.errback}));continue}function v(t){r.callback&&i.send({target:n.source,data:t,type:r.callback})}try{u.callback?u.fn(r.data,v,n):v(u.fn(r.data,n))}catch(s){if(r.errback)i.send({target:n.source,data:s,type:r.errback});else throw s;}}},hash:{send:function(n,r){var o=n.target,e=n.url,u,s,f,h,c,l,a;if(e){if(e=i.hash._url(e),s=i.hash._url(window.location.href),window==o.parent)u="parent";else try{for(f=0,h=parent.frames.length;f<h;f++)if(c=parent.frames[f],c==window){u=f;break}}catch(v){u=window.name}u!=null&&(l={"x-requested-with":"postmessage",source:{name:u,url:s},postmessage:r},a="#x-postmessage-id="+i._random(),o.location=e+a+encodeURIComponent(t.stringify(l)))}},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:50,_bind:function(){i.data("polling.postmessage")||(setInterval(function(){var t=""+window.location.hash,r=i.hash._regex.exec(t),n;r&&(n=r[1],i.hash._last!==n&&(i.hash._last=n,i.hash._dispatch(t.substring(i.hash._regex_len))))},n.pm.poll||200),i.data("polling.postmessage",1))},_dispatch:function(n){var f,l,o,e,a,u,s,v;if(n){try{if(n=t.parse(decodeURIComponent(n)),!(n["x-requested-with"]==="postmessage"&&n.source&&n.source.name!=null&&n.source.url&&n.postmessage))return}catch(h){return}var r=n.postmessage,p=i.data("callbacks.postmessage")||{},c=p[r.type];if(c)c(r.data);else for(f=n.source.name==="parent"?window.parent:window.frames[n.source.name],l=i.data("listeners.postmessage")||{},o=l[r.type]||[],e=0,a=o.length;e<a;e++){if(u=o[e],u.origin&&(s=/https?\:\/\/[^\/]*/.exec(n.source.url)[0],u.origin!=="*"&&s!==u.origin)){r.errback&&(v={message:"postmessage origin mismatch",origin:[s,u.origin]},i.send({target:f,data:v,type:r.errback,hash:!0,url:n.source.url}));continue}function y(t){r.callback&&i.send({target:f,data:t,type:r.callback,hash:!0,url:n.source.url})}try{u.callback?u.fn(r.data,y):y(u.fn(r.data))}catch(h){if(r.errback)i.send({target:f,data:h,type:r.errback,hash:!0,url:n.source.url});else throw h;}}}},_url:function(n){return(""+n).replace(/#.*$/,"")}}},f,h,w=!1,b=["cr","cn","ct","mg","et","pk","tp","sn","ap","ak_guid"],c=[],l=[],e=[],nt=document.location.protocol,r={data:{},load:function(n){for(var r,u,i=document.cookie.split(";"),f=!1,t=0;t<i.length;t++)r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(" ",""),u=u.replace(" ",""),r===n&&(data=ht(u),f=!0);return f?data:!1},save:function(t,i,r){var u=new Date;u.setDate(u.getDate()+3650);var f=i===undefined?u:i,e=r||"/",o=decodeURIComponent(n.param(this.data)),s=ct(window.location.host);document.cookie=t+"="+o+";path="+e+";expires="+f.toGMTString()+";domain=."+s}};Cnv.PostWebEvent=function(n,t,i){var u={};u.pm=n;u.rp=r.data;u.rp.we=t;a(u,"wts/WebEvent",i)};Cnv.RenderContent=function(n){if(n.data=n.data||null,n.success=n.success||function(){},n.error=n.error||function(){},!w){e.push(n);return}var t=g();n.data.GuidId=t;n.data.CustId=r.data.cr;i.send({target:window.frames.cnvIframe,type:"SdkEventListener",data:n.data,error:function(){n.error("error communicating with cnv, please try again or contact support")},success:function(){c[t]=n.success;l[t]=n.error}})};Cnv.Log=function(n,t){var r,i,u;h===!0&&(r=document.getElementById("cnv-log"),i=r.text(),i=i+n.toString(),r.html(i));u={};u.Log=n;url=t===undefined?"sts/Log":t+"/Log";a(u,url,null)};Cnv.init=function(n){try{f=nt+"//"+n.restLink+"/";tt(f,n);n.success&&n.success()}catch(t){n.error(t)}};o=""}(window.jQuery,window.JSON)